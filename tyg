-- 融合脚本：使用F3X创建云朵并添加粒子效果
local Player = game.Players.LocalPlayer
local char = Player.Character or Player.CharacterAdded:Wait()

-- 查找F3X工具
local tool
for _, v in Player:GetDescendants() do
    if v.Name == "SyncAPI" then
        tool = v.Parent
    end
end

for _, v in game.ReplicatedStorage:GetDescendants() do
    if v.Name == "SyncAPI" then
        tool = v.Parent
    end
end

if not tool then
    warn("F3X工具未找到！请确保您拥有F3X建筑工具。")
    return
end

local remote = tool.SyncAPI.ServerEndpoint

-- F3X API函数
function _(args)
    remote:InvokeServer(unpack(args))
end

function SetCollision(part, boolean)
    local args = {"SyncCollision", {{Part = part, CanCollide = boolean}}}
    _(args)
end

function SetAnchor(boolean, part)
    local args = {"SyncAnchor", {{Part = part, Anchored = boolean}}}
    _(args)
end

function CreatePart(cf, parent)
    local args = {"CreatePart", "Normal", cf, parent}
    _(args)
end

function AddMesh(part)
    local args = {"CreateMeshes", {{Part = part}}}
    _(args)
end

function SetMesh(part, meshid)
    local args = {"SyncMesh", {{Part = part, MeshId = "rbxassetid://" .. meshid}}}
    _(args)
end

function MeshResize(part, size)
    local args = {"SyncMesh", {{Part = part, Scale = size}}}
    _(args)
end

function SetColor(part, color)
    local args = {"SyncColor", {{Part = part, Color = color, UnionColoring = false}}}
    _(args)
end

function MovePart(part, cf)
    local args = {"SyncMove", {{Part = part, CFrame = cf}}}
    _(args)
end

-- 创建云朵函数
function CreateCloud()
    local head = char:WaitForChild("Head")
    local cf = head.CFrame + Vector3.new(0, 20, 0) -- 调整高度为20，与原脚本一致
    
    -- 使用F3X创建零件
    CreatePart(cf, workspace)
    
    task.spawn(function()
        local cloudPart
        repeat 
            task.wait(0.1)
            -- 查找新创建的零件
            for _, v in workspace:GetDescendants() do
                if v:IsA("BasePart") and (v.Position - cf.Position).Magnitude < 5 then
                    -- 确保这不是玩家角色的一部分
                    if not v:IsDescendantOf(char) then
                        cloudPart = v
                        break
                    end
                end
            end
        until cloudPart
        
        -- 设置云朵属性
        SetAnchor(true, cloudPart)
        SetCollision(cloudPart, false)
        SetColor(cloudPart, BrickColor.new(333).Color)
        AddMesh(cloudPart)
        SetMesh(cloudPart, "111820358")
        MeshResize(cloudPart, Vector3.new(8, 8, 8))
        
        -- 添加粒子效果（本地效果）
        local P = Instance.new("ParticleEmitter", cloudPart)
        P.Size = NumberSequence.new(0.75)
        P.LockedToPart = true
        P.Texture = "rbxassetid://331959655"
        P.Transparency = NumberSequence.new(0.5)
        P.Acceleration = Vector3.new(0, -20, 0)
        P.EmissionDirection = Enum.NormalId.Bottom
        P.Enabled = true
        P.Rate = 30
        P.Rotation = NumberRange.new(0,360)
        P.RotSpeed = NumberRange.new(0,15)
        P.Speed = NumberRange.new(3,5)
        P.VelocitySpread = 80
        
        -- 让云朵跟随玩家
        game:GetService("RunService").RenderStepped:Connect(function()
            if char and char:FindFirstChild("Head") then
                MovePart(cloudPart, char.Head.CFrame + Vector3.new(0, 20, 0))
            end
        end)
        
-- 执行创建云朵
CreateCloud()
