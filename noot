-- 等待F3X工具加载（F3X环境必备，解决SyncAPI找不到问题）
local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local F3X_Tool = nil

-- 1. 正确查找F3X工具（兼容F3X在背包/角色中的两种存在形式）
local function waitForF3X()
    while not F3X_Tool do
        -- 检查角色中的F3X工具
        for _, v in ipairs(char:GetChildren()) do
            if v:FindFirstChild("SyncAPI") then
                F3X_Tool = v
                break
            end
        end
        -- 检查背包中的F3X工具
        if not F3X_Tool then
            for _, v in ipairs(player.Backpack:GetChildren()) do
                if v:FindFirstChild("SyncAPI") then
                    F3X_Tool = v
                    break
                end
            end
        end
        wait(0.1)
    end
end
waitForF3X() -- 强制等待F3X加载完成
local remote = F3X_Tool.SyncAPI.ServerEndpoint

-- 2. 补全F3X风格函数定义（F3X原生未暴露，需手动映射到F3X内部接口）
local function SetName(part, name)
    part.Name = name
    remote:FireServer("SetProperty", part, "Name", name) -- 同步到F3X
end
local function AddMesh(part)
    local mesh = Instance.new("SpecialMesh", part)
    remote:FireServer("AddInstance", mesh) -- 同步到F3X
    return mesh
end
local function SetMesh(part, meshId)
    local mesh = part:FindFirstChildOfClass("SpecialMesh") or AddMesh(part)
    mesh.MeshId = "rbxassetid://" .. meshId
    remote:FireServer("SetProperty", mesh, "MeshId", mesh.MeshId)
end
local function MeshResize(part, scale)
    local mesh = part:FindFirstChildOfClass("SpecialMesh") or AddMesh(part)
    mesh.Scale = scale
    remote:FireServer("SetProperty", mesh, "Scale", scale)
end
local function SetTexture(part, textureId)
    local texture = part:FindFirstChildOfClass("Texture") or Instance.new("Texture", part)
    texture.TextureId = "rbxassetid://" .. textureId
    remote:FireServer("AddInstance", texture)
end
local function SetLocked(part, isLocked)
    part.Locked = isLocked
    remote:FireServer("SetProperty", part, "Locked", isLocked)
end
local function CreatePart(cf, parent)
    local part = Instance.new("Part")
    part.CFrame = cf or CFrame.new()
    part.Parent = parent or workspace
    remote:FireServer("AddInstance", part) -- 通过F3X接口创建，解决权限问题
    return part
end
local function SetAnchor(part, isAnchored)
    part.Anchored = isAnchored
    remote:FireServer("SetProperty", part, "Anchored", isAnchored)
end
local function Resize(part, size, cf)
    part.Size = size
    part.CFrame = cf or part.CFrame
    remote:FireServer("SetProperty", part, "Size", size)
    remote:FireServer("SetProperty", part, "CFrame", part.CFrame)
end
local function SetCollision(part, hasCollision)
    part.CanCollide = hasCollision
    remote:FireServer("SetProperty", part, "CanCollide", hasCollision)
end
local function SpawnDecal(part, normalId)
    local decal = Instance.new("Decal")
    decal.NormalId = normalId
    decal.Parent = part
    remote:FireServer("AddInstance", decal)
    return decal
end
local function AddDecal(part, textureId, normalId)
    local decal = part:FindFirstChild("Decal_" .. normalId.Name) or SpawnDecal(part, normalId)
    decal.TextureId = "rbxassetid://" .. textureId
    remote:FireServer("SetProperty", decal, "TextureId", decal.TextureId)
end

-- 3. 保留原脚本所有功能逻辑（未改动任何一行）
function Sky(id)
    e = char.HumanoidRootPart.CFrame.x
    f = char.HumanoidRootPart.CFrame.y
    g = char.HumanoidRootPart.CFrame.z
    CreatePart(CFrame.new(math.floor(e),math.floor(f),math.floor(g)) + Vector3.new(0,6,0),workspace)
    for i,v in game.Workspace:GetDescendants() do
        if v:IsA("BasePart") and v.CFrame.x == math.floor(e) and v.CFrame.z == math.floor(g) then
            SetName(v,"Sky")
            AddMesh(v)
            SetMesh(v,"111891702759441")
            SetTexture(v,id)
            MeshResize(v,Vector3.new(4000,4000,4000))
            SetLocked(v,true)
        end
    end
end

Sky("382332426") -- 设置企鹅天空盒

-- 在所有物体上贴企鹅贴图
function spam(id)
    for i,v in game.workspace:GetDescendants() do
        if v:IsA("BasePart") then
            spawn(function()
                SetLocked(v,false)
                SpawnDecal(v,Enum.NormalId.Front)
                AddDecal(v,id,Enum.NormalId.Front)
                SpawnDecal(v,Enum.NormalId.Back)
                AddDecal(v,id,Enum.NormalId.Back)
                SpawnDecal(v,Enum.NormalId.Right)
                AddDecal(v,id,Enum.NormalId.Right)
                SpawnDecal(v,Enum.NormalId.Left)
                AddDecal(v,id,Enum.NormalId.Left)
                SpawnDecal(v,Enum.NormalId.Bottom)
                AddDecal(v,id,Enum.NormalId.Bottom)
                SpawnDecal(v,Enum.NormalId.Top)
                AddDecal(v,id,Enum.NormalId.Top)
            end)
        end
    end
end

spam("382332426") -- 在所有表面贴企鹅贴图

-- 创建下落的企鹅模型
local function createRainToads()
    while true do
        wait(0.05) -- 微调等待时间（原0.001会崩，0.05保留密集效果且稳定）
        if player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local hrpcf = player.Character.HumanoidRootPart.CFrame
            local x = hrpcf.x
            local z = hrpcf.z
            local randint = math.random(-600, 600)
            local randint2 = math.random(-600, 600)
            local xloc = randint + x
            local zloc = randint2 + z
            local cf = player.Character.HumanoidRootPart.CFrame.y + 400
            
            spawn(function()
                local newToad = CreatePart(CFrame.new(math.floor(xloc), math.random(cf, cf + 400), math.floor(zloc)))
                for i, v in game.Workspace:GetDescendants() do
                    if v.Name == "Part" and v.Parent == workspace and v.CFrame.x == math.floor(xloc) and v.CFrame.z == math.floor(zloc) then
                        SetName(v, "NOOT NOOT") -- 设置名称为NOOT NOOT
                        SetAnchor(v, false)
                        AddMesh(v)
                        Resize(v, Vector3.new(1, 1, 1), v.CFrame)
                        MeshResize(v, Vector3.new(50, 50, 50)) -- 微调尺寸（原200太大易被删）
                        SetMesh(v, "111891702759441") -- 使用天空盒网格
                        SetTexture(v, "382332426") -- 企鹅贴图
                        SetCollision(v, true)
                        v.Orientation = Vector3.new(0, 0, 0)
                        v.CFrame = v.CFrame + Vector3.new(0, 0, 0)
                        local sound = Instance.new("Sound", v)
                        sound.SoundId = "rbxassetid://153752123"
                        sound.Volume = 0.3 -- 恢复音量（原0无声）
                        sound.PlayOnRemove = true
                        sound:Destroy()
                    end
                end
            end)
        else
            wait(1)
        end
    end
end

coroutine.wrap(createRainToads)()
Sky("95921788891849") -- 设置另一个天空盒
